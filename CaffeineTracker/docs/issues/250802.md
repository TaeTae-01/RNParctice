# 25.08.02 ì´ìŠˆ ì •ë¦¬

Expo TypeScript + NativeWindCSS v4 í™˜ê²½ êµ¬ì¶• ë° í™˜ê²½ë³€ìˆ˜ ì„¤ì • ê³¼ì •ì—ì„œ ë°œìƒí•œ ì´ìŠˆë“¤ê³¼ í•´ê²° ë°©ë²•ì„ ì •ë¦¬í•œ ë¬¸ì„œ

## ğŸ“¦ í”„ë¡œì íŠ¸ í˜„í™©

### ê¸°ì¡´ í™˜ê²½

- **Expo SDK**: ~53.0.20
- **NativeWind**: v4.1.23 (v2 ì„¤ì •ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆì—ˆìŒ)
- **React Native**: 0.79.5
- **TypeScript**: ~5.8.3

### ì„¤ì¹˜ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬

```bash
# ê¸°ë³¸ ì˜ì¡´ì„± (ì´ë¯¸ ì„¤ì¹˜ë¨)
- @supabase/supabase-js@^2.53.0
- @tanstack/react-query@^5.83.0
- react-native-worklets@^0.4.1
- nativewind@^4.1.23
```

## ğŸš¨ ë°œìƒí•œ ì´ìŠˆë“¤ê³¼ í•´ê²° ë°©ë²•

### ì´ìŠˆ 1: í™˜ê²½ë³€ìˆ˜ í•˜ë“œì½”ë”© ë¬¸ì œ

**ë¬¸ì œ**: Supabase URLê³¼ anon keyê°€ ì½”ë“œì— í•˜ë“œì½”ë”©ë˜ì–´ ë³´ì•ˆìƒ ì·¨ì•½í•¨

**í•´ê²° ë°©ë²•**:

1. **`.env` íŒŒì¼ ìƒì„±**:

```bash
# Supabase ì„¤ì •
EXPO_PUBLIC_SUPABASE_URL=your_supabase_project_url
EXPO_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key

# ì•± í™˜ê²½ ì„¤ì •
EXPO_PUBLIC_APP_ENV=development

# ì¹´í˜ì¸ ê´€ë ¨ ì„¤ì •
EXPO_PUBLIC_CAFFEINE_HALF_LIFE=5.5
EXPO_PUBLIC_DEFAULT_DAILY_LIMIT=400
```

2. **TypeScript íƒ€ì… ì •ì˜ ì—…ë°ì´íŠ¸** (`types/env.d.ts`):

```typescript
declare global {
  namespace NodeJS {
    interface ProcessEnv {
      EXPO_PUBLIC_SUPABASE_URL: string;
      EXPO_PUBLIC_SUPABASE_ANON_KEY: string;
      EXPO_PUBLIC_APP_ENV: 'development' | 'staging' | 'production';
      EXPO_PUBLIC_CAFFEINE_HALF_LIFE: string;
      EXPO_PUBLIC_DEFAULT_DAILY_LIMIT: string;
    }
  }
}
```

3. **ìƒìˆ˜ ê´€ë¦¬ ì‹œìŠ¤í…œ êµ¬ì¶•** (`src/utils/constants.ts`):

```typescript
export const CAFFEINE_HALF_LIFE = parseFloat(
  process.env.EXPO_PUBLIC_CAFFEINE_HALF_LIFE || '5.5'
);

export const BROWN_COLORS = {
  brown: {
    500: '#A0715D', // ë©”ì¸ ë¸Œë¼ìš´
    // ...ë¸Œë¼ìš´ íŒ”ë ˆíŠ¸
  },
} as const;
```

### ì´ìŠˆ 2: NativeWind v4ì™€ v2 ì„¤ì • ì¶©ëŒ (í•µì‹¬ ë¬¸ì œ)

**ì¦ìƒ**:

```bash
[Reanimated] Seems like you are using a Babel plugin `react-native-reanimated/plugin`.
It was moved to `react-native-worklets` package.
Please use `react-native-worklets/plugin` instead.

ERROR index.ts: [BABEL] .plugins is not a valid Plugin property
```

**ì›ì¸**:

- NativeWind v4ê°€ ì„¤ì¹˜ë˜ì–´ ìˆì§€ë§Œ v2 ë°©ì‹ì˜ Babel ì„¤ì •ì„ ì‚¬ìš©
- NativeWind v4ëŠ” ì•„í‚¤í…ì²˜ê°€ ì™„ì „íˆ ë³€ê²½ë˜ì–´ Babel ëŒ€ì‹  Metroì—ì„œ CSS ì²˜ë¦¬
- `react-native-reanimated`ì´ ì˜ì¡´ì„±ìœ¼ë¡œ ì„¤ì¹˜ë˜ì–´ ìˆì§€ë§Œ í˜¸í™˜ì„± ë¬¸ì œ ë°œìƒ

**í•´ê²° ë°©ë²•**:

1. **NativeWind v4 í˜¸í™˜ babel.config.js ì„¤ì •**:

```javascript
module.exports = function (api) {
  api.cache(true);
  return {
    presets: ['babel-preset-expo'], // jsxImportSource ì œê±°
    plugins: ['react-native-worklets/plugin'], // nativewind/babel ì œê±°
  };
};
```

2. **metro.config.js ì„¤ì • ìœ ì§€** (ì´ë¯¸ v4 ë°©ì‹):

```javascript
const { getDefaultConfig } = require('expo/metro-config');
const { withNativeWind } = require('nativewind/metro');

const config = getDefaultConfig(__dirname);
module.exports = withNativeWind(config, {
  input: './assets/styles/global.css',
});
```

3. **ì™„ì „í•œ ì˜ì¡´ì„± ì¬ì„¤ì¹˜**:

```bash
rm -rf node_modules package-lock.json
npm install
npx expo start --clear
```

### ì´ìŠˆ 3: ë¸Œë¼ìš´ í…Œë§ˆ ì‹œìŠ¤í…œ êµ¬ì¶•

**ìš”êµ¬ì‚¬í•­**: ë‹¤í¬ëª¨ë“œ ëŒ€ì‹  ë¸Œë¼ìš´ ì»¬ëŸ¬ ê¸°ë°˜ ë‹¨ì¼ í…Œë§ˆ ì‹œìŠ¤í…œ

**í•´ê²° ë°©ë²•**:

1. **tailwind.config.js ë¸Œë¼ìš´ íŒ”ë ˆíŠ¸ ì ìš©**:

```javascript
module.exports = {
  content: ['./App.tsx', './src/**/*.{js,jsx,ts,tsx}'],
  presets: [require('nativewind/preset')],
  theme: {
    extend: {
      colors: {
        primary: {
          500: '#A0715D', // ë©”ì¸ ë¸Œë¼ìš´
          // ...ë¸Œë¼ìš´ ìŠ¤ì¼€ì¼
        },
        caffeine: {
          light: '#8B4513',
          DEFAULT: '#A0715D',
          dark: '#D2691E',
        },
      },
    },
  },
};
```

2. **global.css ë¸Œë¼ìš´ í…Œë§ˆ ìŠ¤íƒ€ì¼**:

```css
:root {
  --color-background: #fdf8f6;
  --color-primary: #a0715d;
  --color-caffeine: #8b4513;
}

.btn-primary {
  @apply bg-primary-500 text-white px-6 py-3 rounded-xl font-semibold;
}

.caffeine-progress-fill {
  @apply h-full bg-gradient-to-r from-caffeine-light via-caffeine to-caffeine-dark;
}
```

### ì´ìŠˆ 4: SecureStore ì›¹ í˜¸í™˜ì„± ë¬¸ì œ (ë¶€ì°¨ì  ë¬¸ì œ)

**ì¦ìƒ**:

```
TypeError: _ExpoSecureStore.default.getValueWithKeyAsync is not a function
```

**ì›ì¸**: expo-secure-storeê°€ ì›¹ í™˜ê²½ì—ì„œ ì§€ì›í•˜ì§€ ì•ŠëŠ” API ì‚¬ìš©

**í˜„ì¬ ìƒíƒœ**: ëª¨ë°”ì¼ì—ì„œëŠ” ì •ìƒ ì‘ë™, ì›¹ì—ì„œë§Œ ë°œìƒí•˜ëŠ” ê²½ê³ 

**í–¥í›„ í•´ê²° ë°©ì•ˆ**:

```typescript
// ì›¹ìš© fallback ì¶”ê°€ ì˜ˆì •
const storage = Platform.OS === 'web' ? AsyncStorage : SecureStore;
```

## ğŸ”§ NativeWind v4 í•µì‹¬ ë³€ê²½ì 

### v2 â†’ v4 ë§ˆì´ê·¸ë ˆì´ì…˜ í¬ì¸íŠ¸

| ì„¤ì •           | v2 ë°©ì‹                          | v4 ë°©ì‹                    |
| -------------- | -------------------------------- | -------------------------- |
| **Babel ì„¤ì •** | `nativewind/babel` í”ŒëŸ¬ê·¸ì¸ í•„ìš” | í”ŒëŸ¬ê·¸ì¸ ë¶ˆí•„ìš”            |
| **JSX Import** | `jsxImportSource: 'nativewind'`  | ì„¤ì • ë¶ˆí•„ìš”                |
| **CSS ì²˜ë¦¬**   | Babelì—ì„œ ì²˜ë¦¬                   | Metro transformerì—ì„œ ì²˜ë¦¬ |
| **Metro ì„¤ì •** | ì„ íƒì                            | `withNativeWind()` í•„ìˆ˜    |

### ì˜¬ë°”ë¥¸ v4 ì„¤ì • ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] `babel.config.js`ì—ì„œ `nativewind/babel` ì œê±°
- [ ] `babel.config.js`ì—ì„œ `jsxImportSource` ì œê±°
- [ ] `metro.config.js`ì— `withNativeWind()` ì ìš©
- [ ] `tailwind.config.js`ì— `nativewind/preset` ì ìš©
- [ ] ì˜ì¡´ì„± ì¬ì„¤ì¹˜ ë° ìºì‹œ í´ë¦¬ì–´

## ğŸ“š ì°¸ê³  ìë£Œ

- [NativeWind v4 ê³µì‹ ë¬¸ì„œ](https://www.nativewind.dev/docs/getting-started/installation)
- [NativeWind v4 GitHub ì´ìŠˆ](https://github.com/nativewind/nativewind/issues/600#issuecomment-1804741121)
- [Expo í™˜ê²½ë³€ìˆ˜ ê°€ì´ë“œ](https://docs.expo.dev/guides/environment-variables/)

## ğŸ’¡ êµí›ˆ

1. **ë²„ì „ í˜¸í™˜ì„± ì£¼ì˜**: NativeWind v4ëŠ” v2ì™€ ì™„ì „íˆ ë‹¤ë¥¸ ì•„í‚¤í…ì²˜
2. **ê³µì‹ ë¬¸ì„œ ìš°ì„ **: AI ë„êµ¬ë“¤ì´ ê³¼ê±° ë²„ì „ ì„¤ì •ì„ ì œê³µí•  ìˆ˜ ìˆìŒ
3. **ë‹¨ê³„ë³„ ë””ë²„ê¹…**: ì˜ì¡´ì„± íŠ¸ë¦¬ í™•ì¸ìœ¼ë¡œ ê·¼ë³¸ ì›ì¸ íŒŒì•…
4. **í™˜ê²½ë³€ìˆ˜ ë³´ì•ˆ**: ì´ˆê¸° ì„¤ì •ë¶€í„° í™˜ê²½ë³€ìˆ˜ ì‹œìŠ¤í…œ êµ¬ì¶• í•„ìš”
5. **ì™„ì „í•œ ì¬ì„¤ì¹˜**: ì„¤ì • ë³€ê²½ ì‹œ node_modules ì™„ì „ ì‚­ì œ í›„ ì¬ì„¤ì¹˜

## ğŸ¯ í•´ê²° ê²°ê³¼

- âœ… **NativeWind v4 ì„¤ì • ì™„ë£Œ**: `.plugins is not a valid Plugin property` ì—ëŸ¬ í•´ê²°
- âœ… **í™˜ê²½ë³€ìˆ˜ ì‹œìŠ¤í…œ êµ¬ì¶•**: Supabase ì—°ê²° ì •ë³´ ë³´ì•ˆ ì²˜ë¦¬
- âœ… **ë¸Œë¼ìš´ í…Œë§ˆ ì‹œìŠ¤í…œ**: ë‹¨ì¼ í…Œë§ˆ ê¸°ë°˜ ë””ìì¸ ì‹œìŠ¤í…œ êµ¬ì¶•
- âœ… **ì•± ì •ìƒ ì‹¤í–‰**: ì›¹/ëª¨ë°”ì¼ í™˜ê²½ì—ì„œ ì •ìƒ ë²ˆë“¤ë§ ë° ì‹¤í–‰

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

1. **ì‚¬ìš©ì ì¸ì¦ ì‹œìŠ¤í…œ êµ¬í˜„** (ê³ ìš°ì„ ìˆœìœ„)
2. **ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìƒì„±** (ê³ ìš°ì„ ìˆœìœ„)
3. **React Query ìºì‹± ì‹œìŠ¤í…œ êµ¬ì¶•** (ì¤‘ìš°ì„ ìˆœìœ„)
4. **SecureStore ì›¹ í˜¸í™˜ì„± ê°œì„ ** (ì €ìš°ì„ ìˆœìœ„)
